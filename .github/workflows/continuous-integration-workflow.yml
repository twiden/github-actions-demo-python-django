name: Build and test
# This workflow is triggered on pushes to the repository.
on: [push]

jobs:
  checkout:
    name: Checkout
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
  create_env:
    name: Create env
    runs-on: ubuntu-latest
    needs: checkout
    steps:
      - name: Set up Python 3.8
        uses: actions/setup-python@v1
        with:
          python-version: '3.8' # Semantic version range syntax or exact version of a Python version
          architecture: 'x64' # Optional - x64 or x86, defaults to x64
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
      - name: Install system packages
        run: |
          sudo apt-get install -y libpq-dev
      - name: Install application dependencies
        run: |
          sudo pip3 install pipenv
          pipenv install
  test:
    name: Test
    runs-on: ubuntu-latest
    needs: create_env
    steps:
      - name: Run tests
        run: |
          pipenv run python manage.py test
  lint:
    name: Lint
    runs-on: ubuntu-latest
    needs: create_env
    steps:
      - name: Run pyflake8
        run: |
          pipenv run pylint templates
        